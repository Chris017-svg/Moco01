<!doctype html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Shake SOS</title>
    <style>
        body{
            font-family: Arial, "Microsoft JhengHei", sans-serif;
            padding:20px;
            line-height:1.7;
            background:#f7f7f7;
        }

        h2{
            color:#c40000;
        }

        p{
            color:#555;
        }

        button{
            padding:12px 18px;
            font-size:16px;
            border:none;
            border-radius:6px;
            background:#333;
            color:#fff;
        }

        button:disabled{
            background:#999;
        }

        #value{
            margin-top:12px;
            font-size:18px;
            font-weight:600;
        }

        #rule{
            margin-top:8px;
            color:#666;
            font-size:14px;
        }

        #alert{
            display:none;
            margin-top:12px;
            color:#c40000;
            font-weight:bold;
        }

        #call{
            display:none;
            margin-top:14px;
            padding:12px;
            background:#c40000;
            color:#fff;
            text-decoration:none;
            border-radius:6px;
            display:inline-block;
        }
    </style>

</head>
<body>

<h2>Shake SOS ç·Šæ€¥æ±‚åŠ©</h2>
<p>æŒ‰ä¸‹æŒ‰éˆ•æˆæ¬Šå¾Œé–‹å§‹åµæ¸¬ï¼Œç•¶åµæ¸¬åˆ°ä¸æ˜åŠ‡çƒˆæ™ƒå‹•æ™‚ï¼Œå°‡é¡¯ç¤ºç·Šæ€¥è¯çµ¡æŒ‰éˆ•ã€‚</p>

<button id="btn">å–å¾—æ„Ÿæ¸¬å™¨æˆæ¬Šä¸¦é–‹å§‹</button>

<div id="value">ç›®å‰æ™ƒå‹•å¼·åº¦ï¼š-</div>

<div id="rule">â€» æ™ƒå‹•å¹…åº¦é” <strong>15</strong> ä»¥ä¸Šæœƒè¢«åµæ¸¬ç‚ºä¸æ˜åŠ‡çƒˆæ™ƒå‹•</div>

<div id="alert">ğŸš¨ åµæ¸¬åˆ°ä¸æ˜åŠ‡çƒˆæ™ƒå‹•ï¼Œå¦‚æœ‰æ„å¤–è«‹å”åŠ©æ’¥æ‰“ç·Šæ€¥é€£çµ¡äºº</div>

<a id="call" href="tel:">ğŸ“ æ’¥æ‰“ç·Šæ€¥è¯çµ¡äºº</a>

<script>
    const btn=document.getElementById("btn");
    const valueEl=document.getElementById("value");
    const ruleEl=document.getElementById("rule");
    const alertEl=document.getElementById("alert");
    const callEl=document.getElementById("call");

    const THRESHOLD=15,NEED_HITS=2;
    let hit=0,started=false;

    btn.onclick=async()=>{
        if(started)return;

        if(!window.DeviceMotionEvent&&!window.DeviceOrientationEvent){
            alert("æ­¤è£ç½®ä¸æ”¯æ´æ„Ÿæ¸¬å™¨");return;
        }

        if(typeof DeviceOrientationEvent?.requestPermission==="function"){
            const r=await DeviceOrientationEvent.requestPermission();
            if(r!=="granted")return;
        }

        if(typeof DeviceMotionEvent?.requestPermission==="function"){
            const r=await DeviceMotionEvent.requestPermission();
            if(r!=="granted")return;
        }

        window.addEventListener("devicemotion",onMotion,{passive:true});
        started=true;
        btn.disabled=true;
        btn.textContent="æ„Ÿæ¸¬å™¨å·²å•Ÿå‹•";
    };

    function onMotion(e){
        const a=e.accelerationIncludingGravity||e.acceleration;
        if(!a)return;

        const mag=Math.sqrt((a.x||0)**2+(a.y||0)**2+(a.z||0)**2);
        valueEl.textContent="ç›®å‰æ™ƒå‹•å¼·åº¦ï¼š"+mag.toFixed(2);

        if(mag>=THRESHOLD){
            if(++hit>=NEED_HITS){
                alertEl.style.display="block";
                callEl.style.display="inline-block";
                ruleEl.style.display="none";
            }
        }else hit=Math.max(0,hit-1);
    }
</script>

</body>
</html>
