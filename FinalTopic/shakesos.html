<!doctype html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æ–ä¸€æ–ç·Šæ€¥æ±‚åŠ©</title>
    <style>
        body{font-family:sans-serif;padding:20px}
        button,a{padding:12px 16px;font-size:16px}
        #call{display:none;margin-top:20px;background:#d60000;color:#fff;text-decoration:none}
    </style>
</head>
<body>

<button id="start">é–‹å§‹åµæ¸¬</button>
<a id="call" href="tel:0909032711">ğŸ“ æ’¥æ‰“ç·Šæ€¥è¯çµ¡äºº</a>

<script>
    const THRESHOLD = 18; // æ™ƒå‹•é–€æª»
    let hit = 0;
    let started = false;

    document.getElementById("start").addEventListener("click", async () => {

        // é˜²æ­¢é‡è¤‡å•Ÿç”¨
        if (started) return;
        started = true;

        // === iOS å°ˆç”¨æˆæ¬Š ===
        if (
            typeof DeviceMotionEvent !== "undefined" &&
            typeof DeviceMotionEvent.requestPermission === "function"
        ) {
            try {
                const permission = await DeviceMotionEvent.requestPermission();
                if (permission !== "granted") {
                    alert("æœªå…è¨±å‹•ä½œèˆ‡æ–¹å‘æ„Ÿæ¸¬");
                    return;
                }
            } catch (err) {
                alert("æ„Ÿæ¸¬å™¨æˆæ¬Šå¤±æ•—");
                return;
            }
        }

        alert("å·²é–‹å§‹åµæ¸¬ï¼Œè«‹æ–å‹•æ‰‹æ©Ÿ");

        // === Android / iOS å…±ç”¨ ===
        window.addEventListener("devicemotion", handleMotion, { passive: true });
    });

    function handleMotion(e) {
        // iOS å¤šåŠåªèƒ½æ‹¿åˆ° accelerationIncludingGravity
        const a = e.accelerationIncludingGravity || e.acceleration;
        if (!a) return;

        const x = a.x || 0;
        const y = a.y || 0;
        const z = a.z || 0;

        const mag = Math.sqrt(x*x + y*y + z*z);

        if (mag > THRESHOLD) {
            hit++;
            if (hit >= 2) {
                document.getElementById("call").style.display = "inline-block";
            }
        }
    }
</script>

</body>
</html>
