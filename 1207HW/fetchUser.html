<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>Fetch GitHub 使用者範例</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        h1 {
            margin-bottom: 10px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 20px 24px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }
        label {
            font-weight: bold;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px 10px;
            margin: 8px 0 12px;
            border-radius: 4px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        button {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            background: #2563eb;
            color: #fff;
            font-size: 14px;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .hint {
            font-size: 13px;
            color: #555;
            margin-bottom: 12px;
        }
        .results {
            margin-top: 18px;
        }
        .user-card {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 10px 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: #fafafa;
        }
        .user-card img {
            width: 48px;
            height: 48px;
            border-radius: 50%;
        }
        .user-main {
            flex: 1;
        }
        .user-name {
            font-weight: bold;
        }
        .user-login {
            color: #2563eb;
            text-decoration: none;
            font-size: 14px;
        }
        .error {
            color: #b91c1c;
            font-weight: bold;
        }
        .null-user {
            padding: 8px 10px;
            border-radius: 4px;
            background: #fee2e2;
            color: #b91c1c;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Fetch ：查詢 GitHub 使用者</h1>
    <p class="hint">
        請輸入 GitHub 使用者登入名稱（<b>login</b>），多個使用者用逗號分隔，例如：<br>
        <code>octocat, torvalds, gaearon</code>
    </p>

    <label for="namesInput">GitHub 使用者名稱：</label>
    <input id="namesInput" type="text" placeholder="octocat, torvalds" />

    <button id="fetchBtn">查詢</button>

    <div id="status"></div>
    <div id="results" class="results"></div>
</div>

<script>
    // 任務要求的函式：輸入名稱陣列，回傳 GitHub 使用者資料或 null
    async function getUsers(names) {
        const jobs = [];

        for (const name of names) {
            // 直接把處理 status / json / error 的 then/catch 掛在 fetch 上
            const job = fetch(`https://api.github.com/users/${name}`)
                .then(successResponse => {
                    if (!successResponse.ok) {
                        // 狀態不是 200-299，視為失敗，回傳 null
                        return null;
                    }
                    // 轉成 JSON
                    return successResponse.json();
                })
                .catch(() => {
                    // fetch 本身失敗（例如網路問題），回傳 null
                    return null;
                });

            jobs.push(job);
        }

        // 等所有請求（包含 json 解析）完成
        const results = await Promise.all(jobs);
        return results;  // 陣列元素可能是 user 物件或 null
    }

    // 連接畫面上的按鈕邏輯
    const fetchBtn = document.getElementById('fetchBtn');
    const namesInput = document.getElementById('namesInput');
    const resultsDiv = document.getElementById('results');
    const statusDiv = document.getElementById('status');

    fetchBtn.addEventListener('click', async () => {
        let raw = namesInput.value.trim();
        resultsDiv.innerHTML = '';
        statusDiv.textContent = '';

        if (!raw) {
            statusDiv.innerHTML = '<span class="error">請先輸入至少一個使用者名稱。</span>';
            return;
        }

        // 轉成名稱陣列：以逗號分隔並去掉前後空白
        const names = raw.split(',').map(s => s.trim()).filter(Boolean);

        if (names.length === 0) {
            statusDiv.innerHTML = '<span class="error">格式有誤，請重新輸入。</span>';
            return;
        }

        fetchBtn.disabled = true;
        statusDiv.textContent = '查詢中，請稍候…';

        try {
            const users = await getUsers(names);

            statusDiv.textContent = '查詢完成。';

            // 把結果顯示出來
            users.forEach((user, index) => {
                if (user === null) {
                    const nullDiv = document.createElement('div');
                    nullDiv.className = 'null-user';
                    nullDiv.textContent = `使用者「${names[index]}」查無資料或請求失敗。`;
                    resultsDiv.appendChild(nullDiv);
                } else {
                    const card = document.createElement('div');
                    card.className = 'user-card';

                    const avatar = document.createElement('img');
                    avatar.src = user.avatar_url;
                    avatar.alt = user.login;

                    const main = document.createElement('div');
                    main.className = 'user-main';

                    const nameEl = document.createElement('div');
                    nameEl.className = 'user-name';
                    nameEl.textContent = user.name || '(未設定名稱)';

                    const loginLink = document.createElement('a');
                    loginLink.className = 'user-login';
                    loginLink.href = user.html_url;
                    loginLink.target = '_blank';
                    loginLink.rel = 'noopener';
                    loginLink.textContent = `@${user.login}`;

                    const more = document.createElement('div');
                    more.style.fontSize = '13px';
                    more.style.color = '#555';
                    more.textContent = `Public Repos: ${user.public_repos} | Followers: ${user.followers}`;

                    main.appendChild(nameEl);
                    main.appendChild(loginLink);
                    main.appendChild(more);

                    card.appendChild(avatar);
                    card.appendChild(main);

                    resultsDiv.appendChild(card);
                }
            });

        } catch (err) {
            console.error(err);
            statusDiv.innerHTML = '<span class="error">發生未知錯誤，請稍後再試。</span>';
        } finally {
            fetchBtn.disabled = false;
        }
    });
</script>
</body>
</html>
