<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Orientation + Motion Demo</title>
<style>
    * {
        box-sizing: border-box;
    }

    body {
        margin: 0;
        padding: 20px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                     "Microsoft JhengHei", sans-serif;
        background: linear-gradient(135deg, #e0f2fe, #f5f5f5);
        display: flex;
        justify-content: center;
    }

    .wrapper {
        width: 100%;
        max-width: 520px;
        background: #ffffff;
        border-radius: 18px;
        padding: 24px 20px 32px;
        box-shadow: 0 10px 25px rgba(15, 23, 42, 0.15);
    }

    h2 {
        margin-top: 0;
        text-align: center;
        font-size: 1.6rem;
        letter-spacing: 0.08em;
    }

    .subtitle {
        text-align: center;
        color: #6b7280;
        margin-top: 4px;
        margin-bottom: 16px;
        font-size: 0.9rem;
    }

    button {
        display: block;
        margin: 0 auto;
        padding: 10px 22px;
        font-size: 1.1rem;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        background: #2563eb;
        color: #ffffff;
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        transition: transform 0.1s ease, box-shadow 0.1s ease,
                    background 0.2s ease;
    }

    button:hover:not(:disabled) {
        background: #1d4ed8;
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(37, 99, 235, 0.5);
    }

    button:disabled {
        background: #9ca3af;
        box-shadow: none;
        cursor: default;
    }

    .status-tip {
        text-align: center;
        font-size: 0.85rem;
        color: #6b7280;
        margin-top: 8px;
    }

    /* ===== 3D 手機區塊 ===== */
    .phone-section-title {
        margin-top: 20px;
        text-align: center;
        font-weight: 600;
        color: #374151;
    }

    .phone-scene {
        margin: 12px auto 8px;
        width: 220px;
        height: 260px;
        perspective: 900px;
    }

    .phone-wrapper {
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
        transition: transform 0.08s linear;
    }

    .phone {
        position: relative;
        width: 140px;
        height: 240px;
        margin: auto;
        border-radius: 26px;
        background: #111827;
        box-shadow: 0 18px 35px rgba(15, 23, 42, 0.5);
        transform-style: preserve-3d;
    }

    .phone-screen {
        position: absolute;
        inset: 8px;
        border-radius: 20px;
        background: radial-gradient(circle at 0% 0%, #38bdf8, #4f46e5, #ec4899);
        overflow: hidden;
        transform: translateZ(6px);
    }

    .phone-screen::before {
        content: "Demo";
        position: absolute;
        bottom: 12px;
        right: 18px;
        font-size: 0.95rem;
        color: rgba(255,255,255,0.85);
        letter-spacing: 0.12em;
        text-transform: uppercase;
    }

    .phone-notch {
        position: absolute;
        top: 8px;
        left: 50%;
        transform: translateX(-50%) translateZ(7px);
        width: 70px;
        height: 10px;
        border-radius: 0 0 999px 999px;
        background: #020617;
    }

    .phone-side-btn {
        position: absolute;
        right: -3px;
        top: 70px;
        width: 3px;
        height: 46px;
        border-radius: 999px;
        background: #374151;
        transform: translateZ(-3px);
    }

    .phone-small-btn {
        position: absolute;
        left: -3px;
        top: 80px;
        width: 3px;
        height: 30px;
        border-radius: 999px;
        background: #4b5563;
        transform: translateZ(-3px);
    }

    .orientation-hint {
        text-align: center;
        font-size: 0.8rem;
        color: #6b7280;
        margin-bottom: 4px;
    }

    /* ===== 數值卡片 ===== */
    .card {
        margin-top: 22px;
        padding: 14px 14px 10px;
        border-radius: 12px;
        background: #f9fafb;
        border-left: 4px solid #2563eb;
    }

    .card:nth-of-type(2) { border-left-color: #10b981; }
    .card:nth-of-type(3) { border-left-color: #f97316; }
    .card:nth-of-type(4) { border-left-color: #a855f7; }

    h3 {
        margin: 0 0 8px;
        font-size: 1.1rem;
    }

    .val {
        margin: 2px 0;
        font-size: 0.98rem;
        display: flex;
        justify-content: space-between;
        align-items: baseline;
    }

    .label {
        color: #4b5563;
    }

    .value {
        font-family: "Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Monaco,
                      Consolas, "Liberation Mono", "Courier New", monospace;
        background: #ffffff;
        padding: 2px 8px;
        border-radius: 999px;
        min-width: 70px;
        text-align: right;
        box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
    }

    @media (max-width: 480px) {
        .wrapper {
            padding: 20px 16px 26px;
        }
    }
</style>
</head>
<body>

<div class="wrapper">
    <h2>DeviceOrientation + DeviceMotion</h2>
    <p class="subtitle">請按下按鈕授權後，再旋轉手機與搖一搖觀察數值與 3D 手機動作。</p>

    <button id="btn">取得感測器授權並開始</button>
    <p class="status-tip">⚠ 若無反應，請確認瀏覽器支援感測器，且以 HTTPS 或本機檔案開啟。</p>

    <!-- 3D 手機可視化 -->
    <p class="phone-section-title">3D 手機姿態視覺化</p>
    <p class="orientation-hint">上下傾斜、左右翻轉、旋轉手機，看看模型如何跟著動。</p>
    <div class="phone-scene">
        <div id="phoneWrapper" class="phone-wrapper">
            <div class="phone">
                <div class="phone-screen"></div>
                <div class="phone-notch"></div>
                <div class="phone-side-btn"></div>
                <div class="phone-small-btn"></div>
            </div>
        </div>
    </div>

    <!-- 數值顯示卡片 -->
    <div class="card">
        <h3>DeviceOrientation（方向角度）</h3>
        <p class="val">
            <span class="label">Alpha (Z)：</span>
            <span id="alpha" class="value">-</span>
        </p>
        <p class="val">
            <span class="label">Beta (X)：</span>
            <span id="beta" class="value">-</span>
        </p>
        <p class="val">
            <span class="label">Gamma (Y)：</span>
            <span id="gamma" class="value">-</span>
        </p>
    </div>

    <div class="card">
        <h3>DeviceMotion（加速度）</h3>
        <p class="val">
            <span class="label">ax：</span>
            <span id="ax" class="value">-</span>
        </p>
        <p class="val">
            <span class="label">ay：</span>
            <span id="ay" class="value">-</span>
        </p>
        <p class="val">
            <span class="label">az：</span>
            <span id="az" class="value">-</span>
        </p>
    </div>

    <div class="card">
        <h3>DeviceMotion（含重力）</h3>
        <p class="val">
            <span class="label">ax_g：</span>
            <span id="ax_g" class="value">-</span>
        </p>
        <p class="val">
            <span class="label">ay_g：</span>
            <span id="ay_g" class="value">-</span>
        </p>
        <p class="val">
            <span class="label">az_g：</span>
            <span id="az_g" class="value">-</span>
        </p>
    </div>

    <div class="card">
        <h3>Gyroscope 旋轉速率</h3>
        <p class="val">
            <span class="label">α (速度)：</span>
            <span id="rAlpha" class="value">-</span>
        </p>
        <p class="val">
            <span class="label">β (速度)：</span>
            <span id="rBeta" class="value">-</span>
        </p>
        <p class="val">
            <span class="label">γ (速度)：</span>
            <span id="rGamma" class="value">-</span>
        </p>
    </div>
</div>

<script>
const btn = document.getElementById("btn");

// Orientation
const alphaEl = document.getElementById("alpha");
const betaEl  = document.getElementById("beta");
const gammaEl = document.getElementById("gamma");

// Acceleration
const axEl = document.getElementById("ax");
const ayEl = document.getElementById("ay");
const azEl = document.getElementById("az");

// Acceleration including gravity
const axgEl = document.getElementById("ax_g");
const aygEl = document.getElementById("ay_g");
const azgEl = document.getElementById("az_g");

// Rotation rate
const rAlphaEl = document.getElementById("rAlpha");
const rBetaEl  = document.getElementById("rBeta");
const rGammaEl = document.getElementById("rGamma");

// 3D phone wrapper
const phoneWrapper = document.getElementById("phoneWrapper");

btn.addEventListener("click", async () => {
    try {
        // 檢查支援度
        if (!window.DeviceMotionEvent && !window.DeviceOrientationEvent) {
            alert("此裝置不支援 Motion/Orientation 感測器");
            return;
        }

        // iOS 權限（方向）
        if (typeof DeviceOrientationEvent?.requestPermission === "function") {
            const r1 = await DeviceOrientationEvent.requestPermission();
            if (r1 !== "granted") {
                alert("未允許讀取 DeviceOrientation");
                return;
            }
        }

        // iOS 權限（加速度）
        if (typeof DeviceMotionEvent?.requestPermission === "function") {
            const r2 = await DeviceMotionEvent.requestPermission();
            if (r2 !== "granted") {
                alert("未允許讀取 DeviceMotion");
                return;
            }
        }

        window.addEventListener("deviceorientation", (event) => {
            const alpha = event.alpha ?? null; // 0~360
            const beta  = event.beta ?? null;  // -180~180 (X)
            const gamma = event.gamma ?? null; // -90~90  (Y)

            alphaEl.textContent = alpha?.toFixed(2) ?? "-";
            betaEl.textContent  = beta?.toFixed(2) ?? "-";
            gammaEl.textContent = gamma?.toFixed(2) ?? "-";

            // === 更新 3D 手機姿態 ===
            if (alpha !== null && beta !== null && gamma !== null) {
                // 適度縮放，避免轉太誇張
                const rotX = clamp(beta, -70, 70);
                const rotY = clamp(gamma * 1.2, -80, 80);
                const rotZ = alpha % 360;

                phoneWrapper.style.transform =
                    `rotateX(${rotX}deg) rotateY(${rotY}deg) rotateZ(${rotZ}deg)`;
            }
        });

        window.addEventListener("devicemotion", (event) => {
            const acc = event.acceleration || {};
            axEl.textContent = acc.x?.toFixed(2) ?? "-";
            ayEl.textContent = acc.y?.toFixed(2) ?? "-";
            azEl.textContent = acc.z?.toFixed(2) ?? "-";

            const accG = event.accelerationIncludingGravity || {};
            axgEl.textContent = accG.x?.toFixed(2) ?? "-";
            aygEl.textContent = accG.y?.toFixed(2) ?? "-";
            azgEl.textContent = accG.z?.toFixed(2) ?? "-";

            const rot = event.rotationRate || {};
            rAlphaEl.textContent = rot.alpha?.toFixed(2) ?? "-";
            rBetaEl.textContent  = rot.beta?.toFixed(2) ?? "-";
            rGammaEl.textContent = rot.gamma?.toFixed(2) ?? "-";
        });

        btn.disabled = true;
        btn.textContent = "感測器已啟動";

    } catch (err) {
        alert("錯誤：" + err);
    }
});

// 角度限制，避免模型旋轉過頭
function clamp(v, min, max) {
    return Math.min(Math.max(v, min), max);
}
</script>

</body>
</html>
